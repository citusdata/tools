name: Citus package tests

on:
  push:
    branches:
      - "**"

  workflow_dispatch:
    inputs:
      prj_ver:
        description: "The version to be released"
        required: true

jobs:
  test_execution:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        platform:
          - centos/8
          #          - el/8
          #          - ol/7
          #          - debian/stretch
          #          - debian/buster
          #          - debian/bullseye
          #          - ubuntu/bionic
          - ubuntu/focal
    env:
      PLATFORM: ${{ matrix.platform }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install libcurl4-openssl-dev libssl-dev python3-testresources

      - name: Install python requirements
        run: python -m pip install -r packaging_automation/requirements.txt

      - name: Citus package tests
        run: |
          python -m  tools.packaging_automation.test_citus_package \
          --prj_ver "${{ github.event.inputs.prj_ver }}" \
          --os_release ${{ matrix.platform }}
